<?php$userData = $dataAndView->getData("userData");?><script nonce = "<?= $nonce_hash ?>">    $(document).ready(function () {        var service = {};        service.save_profile = function (nombres, apellidos) {            return $.ajax({                type: "post",                url: "/editar_perfil/save_profile",                data: {                    names: nombres,                    last_names: apellidos,                }            })        };        service.new_password = function (contrasena_anterior, contrasena, confirmar_contrasena) {            return $.ajax({                type: "post",                url: "/editar_perfil/save_new_password",                data: {                    previous_password: contrasena_anterior,                    password: contrasena,                    confirm_password: confirmar_contrasena                }            })        };        service.photo_edit = function (dataImg) {            return $.ajax({                type: "post",                url: "/editar_perfil/photo_edit",                contentType:false,                processData:false,                data:dataImg,            })        };        service.user_picture = function () {            return $.ajax({                type: "post",                url: "/editar_perfil/user_photo",            })        };        function img_user () {            $.when(service.user_picture())                .then(function (response) {                    var btnCust = '<button type="button" id="saveProfile"style="margin-left: 5px" class="btn btn-sm btn-success" title="Guardar imagen de perfil" > <i class="fas fa-save"></i></button>';                    $("#input").fileinput({                        theme: 'fas',                        overwriteInitial: true,                        maxFileSize: 3200,                        showClose: false,                        showCaption: false,                        showBrowse: false,                        browseOnZoneClick: true,                        removeLabel: '',                        removeClass: 'btn btn-sm btn-danger',                        removeIcon: '<i class="fa fa-trash"></i>',                        removeTitle: 'Cancelar',                        elErrorContainer: '#kv-avatar-errors-2',                        msgErrorClass: 'alert alert-block alert-danger',                        defaultPreviewContent:'<img id="user-perfil" src="/editar_perfil/user_photo" alt="imagen" class="img-circle img-thumbnail" title="Editar imagen de perfil" style="width: 170px;height: 170px;"> <h6 class="text-muted">click para buscar</h6>',                        layoutTemplates: {main2: '{preview}{remove}'+btnCust+ '{browse}'},                        language: 'es',                        allowedFileExtensions: ["jpg", "png", "jpeg", "bmp", "svg", "gif"]                    });                    var src = '/editar_perfil/user_photo';                    $('#img-user-mini').attr('src',src);                    $(".file-preview").css({"diplay": "block", "display": "inline-block", "border": "0px"});                });        }        $("body").on("click","#saveProfile",function () {            var formData = new FormData();            var file=$('#input').prop('files')[0];            if(file==null) {                return false            }else {                formData.append("img_perfil", file);                $.when(service.photo_edit(formData))                    .then(function (response) {                        noty.show(response.type, response.message);                        $("#input").fileinput('destroy');                        img_user();                    })            }        });        $("body").on("click", "#save_profile", function (e) {            e.preventDefault();                        if (vacio($("#names"), "El campo nombre")) {                return false;            } else if ($("#previous_password").val() === "" ||  $("#previous_password").val() === undefined){                var nombres = $("#names").val();                var apellidos = $("#last_names").val();                $.when(service.save_profile(nombres, apellidos))                    .then(function (response) {                        if(response.estatus == "true"){                            setTimeout(function(){ location.reload(); }, 4000);                        }                        noty.show(response.type, response.message);                    });            }else {                var password_anterior = $("#previous_password").val();                var password_nuevo = $("#new_password").val();                var password_confirmacion = $("#confirm_password").val();                $.when(service.new_password(password_anterior, password_nuevo, password_confirmacion))                    .then(function (response) {                        noty.show(response.type, response.message);                        if(response.estatus == "true"){                            $("#previous_password").val("");                            $("#new_password").val("");                            $("#confirm_password").val("");                        }                    })            }        });        $('body').on('click','#cancel-edit',function () {            window.history.back();        });        img_user();    });</script>